<?php
namespace app\controllers;

use Yii;
use yii\web\Controller;
use app\models\systemdata\Developerinfo;
use app\models\systemdata\Newsinfo;
use app\models\system\TbcuitmoonDictionary;


use app\models\question\Knowledgepoint;
use app\models\question\Questions;
use app\models\question\FindError;
use app\models\exam\Stutestrecorddetails;
use app\models\exam\Stutest;
use app\models\systembase\Studentinfo;
use common\commonFuc;
use app\models\teachplan\Teachingclassdetails;
use app\models\teachplan\Teachingclassmannage;

class IndexController extends Controller
{
    public $layout = 'index';

    public function actionIndex()
    {
        


        $news = new Newsinfo();
        $info = $news->find()->orderBy("releasetime DESC")->all();
        $m_deve = new Developerinfo();
        $deve = $m_deve->find()->asArray()->all();
        $stuTest = (new \yii\db\Query())
        ->select("count(*)as sum,StuNumber,StuName")
        ->from(Stutest::tableName())
        ->limit(5)
        ->groupBy("StuNumber")
        ->orderBy("count(*) DESC")
        ->All();
        return $this->render('//index/index', [
            'info' => $info,
            'deve' => $deve,
            'stuTest' => $stuTest,
        ]);
    }

    public function actionAboutUs()
    {
        return $this->render('//index/about-us');
    }

    public function actionNews()
    {
        $news = new Newsinfo();
        $m_n = Yii::$app->request->get();
        $m_news = $news->find()->where(['newsBh'=>$m_n])->all();

      //echo json_encode($m_news);
       return $this->render('//index/news',[
          'm_news'=>$m_news,
        ]);
    }

    public function actionDeveloper()
    {
        $m_deve = new Developerinfo();
        $deve = $m_deve->find()->all();

        return $this->render('//index/developer', [
            'deve' => $deve,
        ]);
    }

    public function actionNewsList()
    {
        $m_dic = new TbcuitmoonDictionary();
        $news = new Newsinfo();
        $m_news = $news->find()->all();
        return $this->render('//index/NewsList', [
            'type' => $m_dic->getDictionaryList('新闻类型'),
            'm_news'=>$m_news,
        ]);

    }

    public function actionNewsType(){
        $news = new Newsinfo();
        $m_d = Yii::$app->request->get();
        $m_news = $news->find()->where(['newstype'=>$m_d])->asArray()->all();

        echo json_encode($m_news);
    }

    // public function actionClear()
    // {
    //     $allDetail = Stutestrecorddetails::find()->select("DetailsID")->asArray()->all();
    //     foreach ($allDetail as $key => $value) {
    //         $sum = Stutest::find()->where(['DetailsID'=>$value['DetailsID']])->count();
    //         $allDetail[$key]['sum'] = $sum;
    //         if($sum==0)
    //         {
    //             Stutestrecorddetails::deleteAll(['DetailsID'=>$value['DetailsID']]);
    //         }
    //     }
    //     echo json_encode($allDetail);
    // }
    // public function actionSendmail()
    // {
    //     $mail= \Yii::$app->mailer->compose();   
    //     $mail->setTo('626973633@qq.com');  
    //     $mail->setSubject("ubuntu当前登录用户");
    //     $mail->setHtmlBody(\Yii::$app->request->get("id"));    //发布可以带html标签的文本
    //     $mail->send();
    // }
}
?>